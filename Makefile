DOCKER_PREFIX=baylibre
DOCKER_DEV_PREFIX=localhost:5000/baylibre
DOCKER_NAME=repo-resource
DOCKER_DEV_NAME=testing-repo-resource

all: docker

docker:
	docker build . \
		--tag "$(DOCKER_NAME):latest"

dev-docker: docker
	docker build . -f Dockerfile \
		--target tests \
		--tag "$(DOCKER_DEV_NAME):latest"

test: dev-docker
	docker run $(DOCKER_DEV_NAME)

push: docker
		docker image tag ${DOCKER_NAME} ${DOCKER_PREFIX}/${DOCKER_NAME}
		docker push ${DOCKER_PREFIX}/${DOCKER_NAME}

dev-push: docker
		docker image tag ${DOCKER_NAME} ${DOCKER_DEV_PREFIX}/${DOCKER_NAME}
		docker push ${DOCKER_DEV_PREFIX}/${DOCKER_NAME}
